!function(){var t={};window.omelet={salt:function(e,r){if(r){var o=r(t);e&&o&&(window.omelet[e]=o)}}}}(),function(){var t=function(t,e){var r=null,o=null,i=null,n=null;this.create=function(n,s,a){if(a){if(n=n||{},s=s||{},i&&i.forEach(function(e){return a.hasOwnProperty(e)?void 0:void console.log("Entity missing required component: "+t+" needs "+e)}),r)for(var l in r){if(!s.hasOwnProperty(l)||!s[l])return void console.log("Entity missing needed reference: "+t+" references an entity for "+l+" needing a "+r[l]);if(!s[l][r[l]])return void console.log("Referenced entity missing needed component: "+t+" references an entity for "+l+" that needs a "+r[l])}if(o)for(var l in o)n.hasOwnProperty(l)||(n[l]=o[l]);try{return r?[new e(n,s),r,s]:new e(n,s)}catch(h){console.log("Error calling constructor for type: "+t+" error: "+h)}}},this.references=function(t){return t&&t.constructor===Object||console.log("Error setting references.  Must be non-null object with name -> component types."),r=r||t,this},this.requires=function(t){return t&&t.constructor===Array||console.log("Error setting requirements.  Must be an array of required types for this entity."),i=i||t,this},this.defaults=function(t){return t&&t.constructor===Object||console.log("Error setting defaults.  Must be non-null object with name -> default values."),o=o||t,this},this.describe=function(t){return t&&t.constructor===Object||console.log("Error describing properties.  Must be a non-null object representing data properties in json schema format."),n=n||t,this},this.getMetaData=function(){return{defaults:o,requires:i,references:r,propertyDefinitions:n}}};window.omelet.salt("egg",function(e){var r={};return e.eggs=r,function(e,o){if(e&&o){var i=new t(e,o);return r[e]=i,i}}})}(),function(){var t=function(t){var e=[];e.push(t[3]),e.push(-1*t[1]),e.push(-1*t[2]),e.push(t[0]),e.push(t[2]*t[5]-t[4]*t[3]),e.push(t[4]*t[2]-t[0]*t[5]);for(var r=t[0]*e[0]+t[2]*e[1],o=0;6>o;o+=1)e[o]/=r;return e},e=function(t,e,r){var o=r[0]*t+r[2]*e+r[4],i=r[1]*t+r[3]*e+r[5];return[o,i]},r=function(e,r,o){var i=t(o),n=i[0]*e+i[2]*r+i[4],s=i[1]*e+i[3]*r+i[5];return[n,s]},o=function(t,e,r,o){this.currentMatrix=t.slice(),this.context2d=e,this.parent=r?r.slice():null,this.rect=o};o.prototype.getContext=function(){return this.context2d.setTransform.apply(this.context2d,this.currentMatrix),this.context2d},o.prototype.getIdentityContext=function(){return this.context2d.setTransform(1,0,0,1,0,0),this.context2d},o.prototype.transformPoint=function(t,r){return e(t,r,this.currentMatrix)},o.prototype.inverseTransformPoint=function(t,e){return r(t,e,this.currentMatrix)},o.prototype.inverseTransformInParentSpace=function(t,e){return this.parent?r(t,e,this.parent):[t,e]},o.prototype.getRect=function(){return this.rect||[0,0,0,0]},window.omelet.salt(null,function(t){t.wrapContext=function(t){if(!t||t.constructor!==CanvasRenderingContext2D)return void console.log("Error wrapping context.  Passed context must be of type CanvasRenderingContext2D");var i={matrix:[1,0,0,1,0,0],last:null,rect:null},n=function(t){var e=i.matrix.slice();i.matrix[0]=e[0]*t[0]+e[2]*t[1],i.matrix[1]=e[1]*t[0]+e[3]*t[1],i.matrix[2]=e[0]*t[2]+e[2]*t[3],i.matrix[3]=e[1]*t[2]+e[3]*t[3],i.matrix[4]=e[0]*t[4]+e[2]*t[5]+e[4],i.matrix[5]=e[1]*t[4]+e[3]*t[5]+e[5]};return{save:function(){var t=i.matrix.slice(),e=i.rect?i.rect.slice():null;i={matrix:t,last:i,rect:e}},restore:function(){i.last&&(i=i.last)},scale:function(t,e){n([t,0,0,e,0,0])},rotate:function(t){var e=Math.cos(t),r=Math.sin(t);n([e,r,-1*r,e,0,0])},translate:function(t,e){n([1,0,0,1,t,e])},shear:function(t,e){n([1,e,t,1,0,0])},transform:function(t,e,r,o,i,s){n([t,e,r,o,i,s])},setTransform:function(t,e,r,o,n,s){i.matrix=[t,e,r,o,n,s]},reset:function(){i={matrix:[1,0,0,1,0,0],last:null}},transformPoint:function(t,r){return e(t,r,i.matrix)},inverseTransformPoint:function(t,e){return r(t,e,i.matrix)},getSnapshot:function(){return new o(i.matrix,t,i.last?i.last.matrix:null,i.rect)},setRect:function(t){i.rect=t},getRect:function(t){return i.rect||[0,0,0,0]}}}})}(),function(){var t=function(t,e){t.onScreenNode=this,this.entity=t,this.parent=e};t.prototype.remove=function(){this.entity.onScreenNode=null,this.parent.removeNode(this)};var e=function(t,e){this.key=t,this.parent=e,this.keys=[],this.children={},this.nodes=[]};e.prototype.insert=function(r,o){if(r)if(void 0===o&&(o=r.screenSort?r.screenSort.slice():[0]),o.length<1)this.nodes.push(new t(r,this));else{var i=o.shift();if(!this.children[i]){var n=this.keys;this.keys=[];for(var s=0,a=!1;s<n.length;)!a&&n[s]>i&&(this.keys.push(i),a=!0),this.keys.push(n[s]),s+=1;a||this.keys.push(i),this.children[i]=new e(i,this)}this.children[i].insert(r,o)}},e.prototype.removeNode=function(t){for(var e=0;e<this.nodes.length;){if(this.nodes[e]===t)return this.nodes.splice(e,1),void(this.keys.length<1&&this.nodes.length<1&&this.parent&&this.parent.removeTrie(this.key));e+=1}},e.prototype.removeTrie=function(t){delete this.children[t];for(var e=0;e<this.keys.length;){if(this.keys[e]==t)return this.keys.splice(e,1),void(this.keys.length<1&&this.nodes.length<1&&this.parent&&this.parent.removeTrie(this.key));e+=1}},e.prototype.drawNodes=function(t){this.nodes.forEach(function(e){var r=e.entity.draw();r&&t.push({box:r,entity:e.entity})})},e.prototype.draw=function(t){for(var e=0,r=!1;e<this.keys.length;){var o=this.keys[e];!r&&o>0&&(r=!0,this.drawNodes(t)),this.children[o].draw(t),e+=1}r||this.drawNodes(t)},window.omelet.salt(null,function(t){t.createOnScreenTree=function(){var t=new e;return{insert:function(e){t.insert(e)},draw:function(){var e=[];return t.draw(e),e}}}})}(),function(){window.omelet.salt(null,function(e){e.testIntersection=function(e,r){return t(e,r)&&t(r,e)}});var t=function(t,e){if(!t||!e)return!1;var r,o,i,n,s,a,l=t.length,h=e.length;for(r=0;l>r;r+=1){var c=t[(r+1)%l],u=t[r],p=-1*(c[1]-u[1]),f=c[0]-u[0];for(i=Number.MAX_VALUE,n=Number.MIN_VALUE,o=0;l>o;o+=1){var d=p*t[o][0]+f*t[o][1];i>d&&(i=d),d>n&&(n=d)}for(s=Number.MAX_VALUE,a=Number.MIN_VALUE,o=0;h>o;o+=1){var d=p*e[o][0]+f*e[o][1];s>d&&(s=d),d>a&&(a=d)}if(i>a||s>n)return!1}return!0}}(),function(){var t=function(t,e,r){var o=[r[0]-e[0],r[1]-e[1]],i=[t[0]-e[0],t[1]-e[1]],n=o[0]*i[1]-o[1]*i[0];return 0>n?"L":n>0?"R":"N"};window.omelet.salt(null,function(e){e.testPointInPolygon=function(e,r,o){for(var i=[e,r],n=null,s=0;s<o.length;s+=1){var a=o[(s+1)%o.length],l=o[s],h=t(i,l,a);if("N"==h)return!1;if(n){if(n!=h)return!1}else n=h}return!0}})}(),function(){var t=function(t,e,o,i){var n=[],s={},a=function(t,e){e?s[e]=t:t.key.length>0&&(s[t.key]=t),t.hasChildren&&t.children.forEach(a)};if(o){for(var l in o.assets)a(o.assets[l],l);o.hierarchy.forEach(function(t){a(t,null)})}return i&&i.forEach(function(t){a(t,null)}),t.forEach(function(t){if(t){var e=new r;e.matchData(t,s)&&n.push(e)}}),n.forEach(function(t){t.realize(s,e)}),n},e={components:!0,onScreenNode:!0,screenSort:!0,hasChildren:!0,children:!1,key:!1,name:!1,update:!0,preDraw:!0,draw:!0,transform:!0,mouseEnter:!0,mouseExit:!0,mouseUp:!0,mouseDown:!0,mouseClick:!0},r=function(){this.components=[],this.onScreenNode=null,this.screenSort=[],this.hasChildren=!1,this.children=[],this.key="",this.name=""};r.prototype.matchData=function(t,o){if(!t||!o||t.constructor!==Object||o.constructor!==Object)return console.log("Error matching data.  Data obj or key map is falsy or not an Object."),!1;if(t.name&&(t.name.constructor===String?this.name=t.name:console.log("Error matching data.  Non-string name ignored.")),t.key&&(t.key.constructor===String?(this.key=t.key,o[t.key]=this):console.log("Error matching data.  Non-string key ignored.")),t.children)if(t.children.constructor===Array){var i=this;t.children.forEach(function(t){var e=new r;e.matchData(t,o)&&(i.hasChildren=!0,i.children.push(e))})}else console.log("Error matching data.  Non-array children ignored.");for(var n in t){if(e[n])return console.log("Error matching data. Data contains a runtime only property: "+n),!1;e.hasOwnProperty(n)||(this[n]?console.log("Error matching data.  Duplicate component type on entity not allowed: "+n):(this.components.push(n),this[n]=t[n]))}return!0},r.prototype.realize=function(t,e){if(!t||!e||t.constructor!==Object||e.constructor!==Object)return void console.log("Error realizing entity.  Key map or egg carton is falsy or not an Object.");var r=null,o=null,i=null,n=[],s=[],a=[],l=[],h=[],c=[],u=this;this.components.forEach(function(p){if(!e[p])return void console.log("Error realizing component.  No egg registered for type: "+p);var f=u[p],d=null!=f?f.data:null,g=null!=f?f.refs:null;if(null!=g&&g.constructor===Object)for(var m in g){var y=g[m];y&&y.constructor!==String?console.log("Error realizing component.  Referenced value is not a string."):t[y]?g[m]=t[y]:console.log("Error realizing component.  An entity with name: "+this.name+" references an entity for: "+m+" with missing key: "+y)}var v=e[p].create(d,g,u)||{};u[p]=v,v.constructor===Array&&(v=v[0]),v.transform&&v.transform.constructor===Function&&(r?console.log("Error realizing component.  Entity contains two eggs with transform functions.  Only one allowed.  Name: "+this.name+"  Key: "+this.key):r=v),v.preDraw&&v.preDraw.constructor===Function&&(o?console.log("Error realizing component.  Entity contains two eggs with preDraw functions.  Only one allowed.  Name: "+this.name+"  Key: "+this.key):o=v),v.draw&&v.draw.constructor===Function&&(i?console.log("Error realizing component.  Entity contains two eggs with draw functions.  Only one allowed.  Name: "+this.name+"  Key: "+this.key):i=v),v.update&&v.update.constructor===Function&&n.push(v),v.mouseEnter&&v.mouseEnter.constructor===Function&&s.push(v),v.mouseExit&&v.mouseExit.constructor===Function&&a.push(v),v.mouseUp&&v.mouseUp.constructor===Function&&h.push(v),v.mouseDown&&v.mouseDown.constructor===Function&&l.push(v),v.mouseClick&&v.mouseClick.constructor===Function&&c.push(v)}),r&&(this.transform=function(t){try{return r.transform(t)}catch(e){console.error("Error in transform: "+e)}}),o&&i?(this.preDraw=function(t){try{return o.preDraw(t)}catch(e){console.error("Error in preDraw: "+e)}},this.draw=function(){try{return i.draw()}catch(t){console.error("Error in draw: "+t)}}):(o||i)&&console.log("Error realizing component.  Component must define both preDraw and draw, or neither."),n.length>0&&(this.update=function(t){n.forEach(function(e){try{e.update(t)}catch(r){console.error("Error in update: "+r)}})}),s.length>0&&(this.mouseEnter=function(){s.forEach(function(t){try{t.mouseEnter()}catch(e){console.error("Error in mouseEnter: "+e)}})}),a.length>0&&(this.mouseExit=function(){a.forEach(function(t){try{t.mouseExit()}catch(e){console.error("Error in mouseExit: "+e)}})}),h.length>0&&(this.mouseUp=function(){h.forEach(function(t){try{t.mouseUp()}catch(e){console.error("Error in mouseUp: "+e)}})}),l.length>0&&(this.mouseDown=function(){l.forEach(function(t){try{t.mouseDown()}catch(e){console.error("Error in mouseDown: "+e)}})}),c.length>0&&(this.mouseClick=function(){c.forEach(function(t){try{t.mouseClick()}catch(e){console.error("Error in mouseClick: "+e)}})}),this.hasChildren&&this.children.forEach(function(r){r.realize(t,e)})},r.prototype.getChildByName=function(t,e){if(t&&this.hasChildren){var r=null,o=function(e){r||(e.name==t?r=e:e.hasChildren&&e.children.forEach(o))};return this.children.forEach(o),r&&e?r[e]:r}},window.omelet.salt(null,function(e){e.realize=function(r,o){if(r)if(r.constructor===String)try{var i=JSON.parse(r);return i.constructor!==Object?console.log("Error realizing data, input must be JSON representation of an object."):(i.assets&&(i.assets.constructor!==Array?console.log("Error realizing data, assets must be a JSON array of entities."):i.assets=t(i.assets,e.eggs,o)),i.the&&(i.the.constructor!==Array?console.log("Error realizing data, the must be a JSON array of entities."):i.the=t(i.the,e.eggs,o,i.assets)),i.hierarchy&&(i.hierarchy.constructor!==Array?console.log("Error realizing data, hierarchy must be a JSON array of entities."):i.hierarchy=t(i.hierarchy,e.eggs,o,i.assets))),i}catch(n){console.log("Error realizing data.  JSON parse failed: "+n)}else console.log("Error realizing data.  Data Objects are not supported with prototypes of: "+r.constructor);else console.log("Error realizing data.  Falsy input cannot be realized.")}}),window.omelet.salt(null,function(t){t.checkIsEntity=function(t){return t&&t.constructor===r}})}(),function(){var t=function(t){var e=42,r=!1;this.camera={x:0,y:0,angle:0,zoom:1,rotate90:!1},this.assets={},this.layers={},this.the={},this.hierarchy=[],this.mousePosition=[0,0],this.mouseDown=!1,this.setLayers=function(t){if(t&&!t.constructor!==Object){for(var e in this.layers)delete this.layers[e];for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r&&r.constructor===Number&&(this.layers[e]=t[e])}}},this.addData=function(e){var r=t.realize(e,this)||{};r.assets&&o(r.assets,this),r.the&&i(r.the,this),r.hierarchy&&n(r.hierarchy,this)};var o=function(t,o){if(t){t.forEach(function(t){var r=t.key||t.name;r&&!o.assets[r]||(r=e.toString(),e+=1),o.assets[r]=t});var o=this;r&&t.forEach(function(t){h(t,o),c(t,o)})}},i=function(t,e){t&&(t.forEach(function(t){t.components.forEach(function(r){e.the[r]?console.log("Error adding component to the, the already contains a component of type: "+r):e.the[r]=t[r]})}),r&&t.forEach(function(t){h(t,e),c(t,e)}))},n=function(t,e){t&&(t.forEach(function(t){e.hierarchy.push(t)}),r&&t.forEach(function(t){h(t,e),c(t,e)}))};this.removeFromHierarchy=function(e){return t.checkIsEntity(e)?(a(e),s(this.hierarchy,e)?void 0:void console.log("Error removing entity from hierarchy.  Entity could not be found in this scene.")):void console.log("Error removing entity from hierarchy.  Argument entity is not of type OmeletEntity.")},this.clearHeirarchy=function(){for(this.hierarchy.forEach(a);this.hierarchy.length>0;)this.hierarchy.pop()},this.initialize=function(){if(!r){r=!0;for(var t in this.assets)h(this.assets[t],e),c(this.assets[t],this);for(var t in this.the)h(this.the[t],e),c(this.the[t],this);var e=this;this.hierarchy.forEach(function(t){h(t,e),c(t,e)})}},this.update=function(t){for(var e in this.the){var r=this.the[e];if(r.update&&r.update.constructor===Function)try{r.update(t)}catch(o){console.error(o)}}this.hierarchy.forEach(function(e){l(e,t)})},this.findEntityForKey=function(t){if(this.assets.hasOwnProperty(t))return this.assets[t];if(this.the.hasOwnProperty(t))return this.the[t];var e=function(r){for(var o=0;o<r.length;o++){var i=r[o];if(i.key===t)return i;if(i.hasChildren){var n=e(i.children);if(n)return n}}};return e(this.hierarchy)};var s=function(t,e){for(var r=0;r<t.length;r++){if(t[r]===e)return t.splice(r,1),!0;if(t[r].hasChildren&&s(t[r].children,e))return!0}return!1},a=function(t){t.onScreenNode&&t.onScreenNode.remove(),t.hasChildren&&t.children.forEach(a)},l=function(t,e){t.update&&t.update(e),t.hasChildren&&t.children.forEach(function(t){l(t,e)})},h=function(t,e){t.components.forEach(function(e){var r=t[e];if(r.constructor===Array){var o=r[0],i=r[1],n=r[2];for(var s in i){var a=n[s][i[s]];a.constructor===Array&&(a=a[0]),n[s]=a}t[e]=o}}),t.hasChildren&&t.children.forEach(function(t){h(t,e)})},c=function(t,e){t.components.forEach(function(r){var o=t[r];o.ready&&o.ready.constructor===Function&&o.ready(e,t)}),t.hasChildren&&t.children.forEach(function(t){c(t,e)})}};window.omelet.salt("createEmptyScene",function(e){return function(){return new t(e)}}),window.omelet.salt(null,function(e){e.checkIsScene=function(e){return e&&e.constructor===t}})}(),function(){window.omelet.salt("makeGame",function(t){return function(e,r){if(!e||e.constructor!=HTMLCanvasElement)return void console.log("Error making game.  Canvas Element must be non-null object of type HTMLCanvasElement.");if(!t.checkIsScene(r))return void console.log("Error making game. Scene object must be non-null object of type Scene.");var o=e.getContext("2d"),i=o.width,n=o.height,s=[],a=t.wrapContext(o),l=t.createOnScreenTree(),h=[-10,-10],c=!1,u=!1,p=null,f=null,d=!1,g=!1,m=0,y=r.camera,v=(r.assets,r.the,r.hierarchy);e.addEventListener("mousedown",function(t){c=!0,t.preventDefault()}),e.addEventListener("mouseup",function(t){c=!1,t.preventDefault()}),e.addEventListener("mousemove",function(t){var r=e.getBoundingClientRect();h=[t.clientX-r.left,t.clientY-r.top],t.preventDefault()}),e.addEventListener("click",function(t){d=!0;var r=e.getBoundingClientRect();h=[t.clientX-r.left,t.clientY-r.top],t.preventDefault()}),e.addEventListener("touchstart",function(t){c=!0;var r=e.getBoundingClientRect(),o=t.touches[0];o&&(h=[o.clientX-r.left,o.clientY-r.top]),t.preventDefault()}),e.addEventListener("touchend",function(t){c=!1;var r=e.getBoundingClientRect(),o=t.touches[0];o&&(h=[o.clientX-r.left,o.clientY-r.top]),t.preventDefault()}),e.addEventListener("touchcancel",function(t){c=!1;var r=e.getBoundingClientRect(),o=t.touches[0];o&&(h=[o.clientX-r.left,o.clientY-r.top]),t.preventDefault()}),e.addEventListener("touchmove",function(t){var r=e.getBoundingClientRect(),o=t.touches[0];o&&(h=[o.clientX-r.left,o.clientY-r.top]),t.preventDefault()}),r.context=o,r.canvas=e;var b=function(e){if(a.save(),e.transform)var r=e.transform(a);if(e.preDraw){var o=e.preDraw(r||a.getSnapshot());t.testIntersection(s,o)?e.onScreenNode||l.insert(e):e.onScreenNode&&e.onScreenNode.remove()}e.hasChildren&&e.children.forEach(b),a.restore()},w=function(e){for(r.mousePosition=h,r.mouseDown=c;e.length>0;){var o=e.pop(),i=h[0],n=h[1];if(t.testPointInPolygon(i,n,o.box))return f!=o.entity&&(f&&f.mouseExit&&f.mouseExit(),f=o.entity,p=null,f.mouseEnter&&f.mouseEnter()),!u&&d&&f.mouseClick&&f.mouseClick(),u!=c&&(c&&(p=h.slice()),c&&f.mouseDown?f.mouseDown():!c&&f.mouseUp&&f.mouseUp(),!c&&p&&Math.sqrt(Math.pow(p[0]-h[0],2)+Math.pow(p[1]-h[1],2))<25&&f.mouseClick&&f.mouseClick(),u=c),void(d=!1)}f&&f.mouseExit&&f.mouseExit(),d=!1,p=null,f=null,u=c},C=function(t){if(i=e.width,n=e.height,s=[[0,0],[i,0],[i,n],[0,n]],t){var h=(new Date).getTime(),c=(h-(m||h))/1e3;c>1&&(c=.016),m=h,r.update(c)}a.save(),a.translate(i/2,n/2),a.scale(y.zoom,y.zoom),a.translate(-1*y.x,-1*y.y),y.rotate90&&a.rotate(Math.PI/2),0!=y.angle&&a.rotate(-1*y.angle);var u=i/y.zoom,p=n/y.zoom;y.rotate90?a.setRect([p/-2,u/-2,p,u]):a.setRect([u/-2,p/-2,u,p]),v.forEach(b),o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,i,n);var f=l.draw();f&&f.length>0&&w(f),a.restore(),g&&window.requestAnimationFrame(C)};return r.initialize(),{start:function(){g||(g=!0,window.requestAnimationFrame(C))},stop:function(){g=!1},doFrameSkipUpdate:function(){g=!1,C(!1)}}}})}(),window.omelet.salt("getJSONSchema",function(t){return function(){var e={$schema:"http://json-schema.org/draft-04/schema#",title:"OmeletEntityList",description:"Schema for a list of omelet entities using loaded eggs.",type:"object",properties:{assets:{type:"array",items:{$ref:"#/definitions/Entity"}},the:{type:"array",items:{$ref:"#/definitions/Entity"}},hierarchy:{type:"array",items:{$ref:"#/definitions/Entity"}}},definitions:{Entity:{type:"object",properties:{key:{type:"string"},name:{type:"string"},children:{type:"array",items:{$ref:"#/definitions/Entity"}}},additionalProperties:!1}}},r=e.definitions.Entity.properties,o=function(t,e){var o={type:"object",properties:{data:{type:"object",properties:{}},refs:{type:"object",required:[],properties:{},additionalProperties:!1}},additionalProperties:!1};if(e&&e.propertyDefinitions&&(o.properties.data.properties=e.propertyDefinitions,o.properties.data.additionalProperties=!1),e&&e.references){o.required=["refs"];for(var i in e.references)o.properties.refs.required.push(i),o.properties.refs.properties[i]={type:"string"}}r[t]=o};for(var i in t.eggs)o(i,t.eggs[i].getMetaData());return e}}),window.omelet.egg("omelet.puppet.poses",function(t,e){this.poses=t.poses;var r={},o=null,i=null;this.ready=function(e,r){o=r,t.defaultPose&&this.setPose(t.defaultPose)},this.setPose=function(t){i=null;var e=this.poses[t];e||console.warn("No data for a pose named: "+t);for(var n in e)if(r.hasOwnProperty(n)||(r[n]=o.getChildByName(n,"omelet.transform")),!r[n])return void console.error("Cannot set pose: "+t+" because there is no child part named: "+n);for(var n in e){var s=r[n],a=e[n];a.hasOwnProperty("x")&&(s.x=a.x),a.hasOwnProperty("y")&&(s.y=a.y),a.hasOwnProperty("angle")&&(s.angle=a.angle)}},this.transition=function(t,e,n,s){if(t){var a=this.poses[t];if(a){var l=[];for(var h in a)for(var h in a){r.hasOwnProperty(h)||(r[h]=o.getChildByName(h,"omelet.transform"));var c=r[h];if(!c)return void console.error("Cannot set pose: "+t+" because there is no child part named: "+h);var u={start:{},end:{},transform:c},p=a[h];if(p.hasOwnProperty("x")){var f=c.x;f!=p.x&&(u.start.x=f,u.end.x=p.x)}if(p.hasOwnProperty("y")){var f=c.y;f!=p.y&&(u.start.y=f,u.end.y=p.y)}if(p.hasOwnProperty("angle")){var f=c.angle;f!=p.angle&&(u.start.angle=f,u.end.angle=p.angle)}l.push(u)}if(e=e||1e-5,0>=e&&(e=1e-5),n=n||"linear",s=s||3,n.constructor===String)switch(n){case"ease-out":n=function(t){return 1-Math.pow(1-t,s)};break;case"ease-in":n=function(t){return Math.pow(t,s)};break;case"ease-out-in":n=function(t){return.5>t?(1-Math.pow(1-2*t,s))/2:(.5+Math.pow(2*(t-.5),s))/2};break;case"ease-in-out":n=function(t){return.5>t?Math.pow(2*t,s)/2:(2-Math.pow(1-2*(t-.5),s))/2};break;case"linear":default:n=function(t){return t}}else n.constructor!==Function&&(n=function(t){return t});i={progress:0,duration:e,ease:n,parts:l}}}},this.update=function(t){if(i){i.progress+=t/i.duration,i.progress>1&&(i.progress=1);var e=i.ease(i.progress);i.parts.forEach(function(t){for(var r in t.start){var o=t.start[r],i=t.end[r];t.transform[r]=o+(i-o)*e}}),1==i.progress&&(i=null)}}}).defaults({poses:{},defaultPose:null}).describe({defaultPose:{type:"string"},poses:{type:"object",patternProperties:{".*":{type:"object",patternProperties:{".*":{type:"object",properties:{x:{type:"number"},y:{type:"number"},angle:{type:"number"}}}}}}}}),window.omelet.egg("omelet.puppet.sequence",function(t,e){this.sequences=t.sequences;var r,o,i=null,n=null;this.ready=function(t,e){i=e["omelet.puppet.poses"]},this.playSequence=function(t){n=this.sequences[t],r=0,o=0},this.update=function(t){if(n&&(r+=t,r>=n[o].atTime)){var e=n[o];i.transition(e.pose,e.duration,e.ease,e.easeExp),o+=1,o==n.length&&(n=null)}}}).defaults({sequences:{}}).requires(["omelet.puppet.poses"]).describe({sequences:{type:"object",patternProperties:{".*":{type:"array",items:{type:"object",required:["atTime","pose","duration","ease","easeExp"],properties:{atTime:{type:"number"},pose:{type:"string"},duration:{type:"number"},ease:{type:"string"},easeExp:{type:"number"}}}}}}}),window.omelet.egg("omelet.sprites.spriteRenderer",function(t,e){this.spriteName=t.spriteName;var r=null,o=null,i=null;this.ready=function(r,o){o.screenSort=[r.layers[t.layer]||0,t.orderInLayer],i=e.spriteSheet},this.preDraw=function(t){if(r=t,o=[],!i||!i.loaded)return o;var e=i.sprites[this.spriteName];return e?(o.push(t.transformPoint(-1*e.pivotX,-1*e.pivotY)),o.push(t.transformPoint(e.width-e.pivotX,-1*e.pivotY)),o.push(t.transformPoint(e.width-e.pivotX,e.height-e.pivotY)),o.push(t.transformPoint(-1*e.pivotX,e.height-e.pivotY)),o):o},this.draw=function(){var t=r.getContext(),e=i.sprites[this.spriteName];return t.drawImage(i.image,e.x,e.y,e.width,e.height,-1*e.pivotX,-1*e.pivotY,e.width,e.height),o}}).defaults({spriteName:"Default",layer:"default",orderInLayer:0}).references({spriteSheet:"omelet.sprites.spriteSheet"}).describe({spriteName:{type:"string"},layer:{type:"string"},orderInLayer:{type:"integer"}}),window.omelet.egg("omelet.sprites.spriteSheet",function(t,e){this.image=new Image,this.sprites=t.sprites,this.loaded=!1;var r=this;this.image.addEventListener("load",function(){r.loaded=!0}),this.image.src=t.src}).defaults({src:"./Omelet.png",sprites:{Default:{x:0,y:0,width:400,height:400,pivotX:200,pivotY:200}}}).describe({src:{type:"string"},sprites:{type:"object",patternProperties:{".*":{type:"object",required:["x","y","width","height","pivotX","pivotY"],properties:{x:{type:"number"},y:{type:"number"},width:{type:"number"},height:{type:"number"},pivotX:{type:"number"},pivotY:{type:"number"}}}}}}),window.omelet.egg("omelet.shapes.circle",function(t,e){this.fillColor=t.fillColor,this.strokeColor=t.strokeColor,this.strokeWidth=t.strokeWidth,this.radius=t.radius,this.globalCompositeOperation=t.globalCompositeOperation;var r=null,o=null;this.ready=function(e,r){r.screenSort=[e.layers[t.layer]||0,t.orderInLayer]},this.preDraw=function(t){r=t,o=[];for(var e=0;e<2*Math.PI;e+=Math.PI/5)o.push(t.transformPoint(this.radius*Math.cos(e),this.radius*Math.sin(e)));return o},this.draw=function(){if(r){var t=r.getContext();return this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation),t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),this.fillColor&&(t.fillStyle=this.fillColor,t.fill()),this.strokeColor&&(t.strokeColor=this.strokeColor,t.lineWidth=this.strokeWidth,t.stroke()),this.globalCompositeOperation&&(t.globalCompositeOperation="source-over"),o}}}).defaults({fillColor:null,strokeColor:null,strokeWidth:1,radius:15,layer:"default",orderInLayer:0,globalCompositionOperation:null}).describe({fillColor:{type:"string"},strokeColor:{type:"string"},strokeWidth:{type:"number"},radius:{type:"number"},globalCompositionOperation:{"enum":["source-over","source-atop","source-in","source-out","destination-over","destination-atop","destination-in","destination-out","lighter","copy","xor"]},layer:{type:"string"},orderInLayer:{type:"integer"}}),window.omelet.egg("omelet.shapes.polygon",function(t,e){this.points=t.points,this.fillColor=t.fillColor,this.strokeColor=t.strokeColor,this.strokeWidth=t.strokeWidth,this.globalCompositeOperation=t.globalCompositeOperation;var r=null,o=null,i=null;this.ready=function(e,r){r.screenSort=[e.layers[t.layer]||0,t.orderInLayer]},this.preDraw=function(t){return null==this.points&&(this.points=[]),null!=r&&r.cacheKey==this.points.cacheKey||(r=n(this.points)),o=t,i=[],r.points.forEach(function(e){i.push(t.transformPoint(e[0],e[1]))}),i},this.draw=function(){if(o){var t=o.getContext();this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation);var e=this.points[0];t.beginPath(),t.moveTo(e[0],e[1]);for(var r=1;r<this.points.length;r+=1)e=this.points[r],t.lineTo(e[0],e[1]);return t.closePath(),this.fillColor&&(t.fillStyle=this.fillColor,t.fill()),this.strokeColor&&(t.strokeStyle=this.strokeColor,t.lineWidth=this.strokeWidth,t.stroke()),this.globalCompositeOperation&&(t.globalCompositeOperation="source-over"),i}};var n=function(t){t.cacheKey=Math.random()*Number.MAX_VALUE;var e={cacheKey:t.cacheKey,points:[]};if(t.length<4)return e.points=t,e;var r=[Number.MAX_VALUE],o=[Number.MIN_VALUE];t.forEach(function(t){t[0]<r[0]?r=t:t[0]>o[0]&&(o=t)});var i=[],n=[];t.forEach(function(t){if(t!=r&&t!=o)switch(a(t,r,o)){case"L":i.push(t);break;case"R":n.push(t)}});for(var l=s(i,r,o,"L"),h=s(n,r,o,"R"),c=h.length-2;c>0;c-=1)l.push(h[c]);return e.points=l,e},s=function(t,e,r,o){if(t.length<1)return[e,r];var i=null,n=Number.MIN_VALUE;t.forEach(function(t){var o=l(t,e,r);o>n&&(n=o,i=t)});var h=[],c=[];t.forEach(function(t){t!=i&&(a(t,e,i)==o?h.push(t):a(t,i,r)==o&&c.push(t))});for(var u=s(h,e,i,o),p=s(c,i,r,o),f=1;f<p.length;f+=1)u.push(p[f]);return u},a=function(t,e,r){var o=[r[0]-e[0],r[1]-e[1]],i=[t[0]-e[0],t[1]-e[1]],n=o[0]*i[1]-o[1]*i[0];return 0>n?"L":n>0?"R":"N"},l=function(t,e,r){var o=r[0]-e[0],i=r[1]-e[1];return Math.abs(i*t[0]-o*t[1]+r[0]*e[1]-r[1]*e[0])/Math.sqrt(Math.pow(o,2)+Math.pow(i,2))}}).defaults({points:[[-10,-10],[10,-10],[0,20]],fillColor:null,strokeColor:null,strokeWidth:1,layer:"default",orderInLayer:0,globalCompositeOperation:null}).describe({points:{type:"array",items:{type:"array",items:{type:"number",minItems:2,maxItems:2},minItems:2}},fillColor:{type:"string"},strokeColor:{type:"string"},strokeWidth:{type:"number"},globalCompositeOperation:{"enum":["source-over","source-atop","source-in","source-out","destination-over","destination-atop","destination-in","destination-out","lighter","copy","xor"]},layer:{type:"string"},orderInLayer:{type:"integer"}}),window.omelet.egg("omelet.shapes.rectangle",function(t,e){this.fillColor=t.fillColor,this.strokeColor=t.strokeColor,this.strokeWidth=t.strokeWidth,this.width=t.width,this.height=t.height,this.globalCompositeOperation=t.globalCompositeOperation;var r=0,o=0,i=null,n=null;this.ready=function(e,r){r.screenSort=[e.layers[t.layer]||0,t.orderInLayer]},this.preDraw=function(t){return i=t,n=[],r=this.width/2,o=this.height/2,n.push(t.transformPoint(-1*r,-1*o)),n.push(t.transformPoint(r,-1*o)),n.push(t.transformPoint(r,o)),n.push(t.transformPoint(-1*r,o)),n},this.draw=function(){if(i){var t=i.getContext();return this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation),this.fillColor&&(t.fillStyle=this.fillColor,t.fillRect(-1*r,-1*o,this.width,this.height)),this.strokeColor&&(t.strokeColor=this.strokeColor,t.lineWidth=this.strokeWidth,t.strokeRect(-1*r,-1*o,this.width,this.height)),this.globalCompositeOperation&&(t.globalCompositeOperation="source-over"),n}}}).defaults({fillColor:null,strokeColor:null,strokeWidth:1,width:15,height:15,layer:"default",orderInLayer:0,globalCompositionOperation:null}).describe({fillColor:{type:"string"},strokeColor:{type:"string"},strokeWidth:{type:"number"},width:{type:"number"},height:{type:"number"},globalCompositionOperation:{"enum":["source-over","source-atop","source-in","source-out","destination-over","destination-atop","destination-in","destination-out","lighter","copy","xor"]},layer:{type:"string"},orderInLayer:{type:"integer"}}),window.omelet.egg("omelet.ui.circle",function(t,e){this.fillStyle=t.fillStyle,this.strokeColor=t.strokeColor,this.strokeWidth=t.strokeWidth,this.hitTarget=t.hitTarget,this.shadowDistance=t.shadowDistance,this.shadowColor=t.shadowColor,this.globalCompositeOperation=t.globalCompositeOperation;var r,o,i,n=null,s=null;this.ready=function(e,r){r.screenSort=[e.layers[t.layer]||0,t.orderInLayer]},this.preDraw=function(t){n=t;var e=t.getRect(),a=e[0],l=e[1],h=e[2],c=e[3],u=c>h?h:c;h>u?a+=(h-u)/2:c>u&&(l+=(c-u)/2),i=u/2,r=a+i,o=l+i,s=[];for(var p=0;p<2*Math.PI;p+=Math.PI/5)s.push(t.transformPoint(r+i*Math.cos(p),o+i*Math.sin(p)));return s},this.draw=function(t){if(n){t||0==this.shadowDistance||this.draw(!0);var e=n.getContext();this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation);var a=t?r+this.shadowDistance:r,l=t?o+this.shadowDistance:o;e.beginPath(),e.arc(a,l,i,0,2*Math.PI),e.closePath();var h=t?this.shadowColor:this.fillStyle;return h&&(e.fillStyle=h,e.fill()),!t&&this.strokeColor&&(e.lineWidth=this.strokeWidth,e.strokeStyle=this.strokeColor,e.stroke()),this.globalCompositeOperation&&(e.globalCompositeOperation="source-over"),this.hitTarget?s:void 0}}}).defaults({fillStyle:null,strokeColor:null,strokeWidth:1,layer:"default",orderInLayer:0,hitTarget:!1,shadowDistance:0,shadowColor:"rgba(0, 0, 0, .3)",globalCompositeOperation:null}).describe({fillStyle:{oneOf:[{type:"string"},{type:"object",properties:{top:{type:"string",bottom:{type:"string"}}},required:["top","bottom"]},{type:"object",properties:{left:{type:"string",right:{type:"string"}}},required:["left","right"]}]},strokeColor:{type:"string"},strokeWidth:{type:"number"},layer:{type:"string"},orderInLayer:{type:"integer"},shadowDistance:{type:"number"},shadowColor:{type:"string"},hitTarget:{type:"boolean"},globalCompositeOperation:{type:"string"}}),window.omelet.egg("omelet.ui.pillRectangle",function(t,e){this.fillStyle=t.fillStyle,this.strokeColor=t.strokeColor,this.strokeWidth=t.strokeWidth,this.hitTarget=t.hitTarget,this.shadowDistance=t.shadowDistance,this.shadowColor=t.shadowColor,this.globalCompositeOperation=t.globalCompositeOperation;var r,o,i,n,s,a,l,h=null,c=null,u=null;this.ready=function(e,r){r.screenSort=[e.layers[t.layer]||0,t.orderInLayer]},this.preDraw=function(t){
h=t;var e=t.getRect();o=e[1],a=e[3],n=o+a,l=.5*a;var u=o+l;if(s=e[2],s-=a,0>s){s=0;var p=e[0]+.5*e[2];r=p,i=p}else r=e[0]+l,i=r+s;c=[];for(var f=Math.PI/2;f>=Math.PI/-2;f-=Math.PI/5)c.push(t.transformPoint(i+l*Math.cos(f),u-l*Math.sin(f)));for(var f=Math.PI/-2;f>=-3*Math.PI/2;f-=Math.PI/5)c.push(t.transformPoint(r+l*Math.cos(f),u-l*Math.sin(f)));return c},this.draw=function(t){if(h){t||0==this.shadowDistance||this.draw(!0);var e=h.getContext();if(this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation),t&&e.translate(this.shadowDistance,this.shadowDistance),e.beginPath(),e.moveTo(r,o),e.lineTo(i,o),e.arcTo(i+l,o,i+l,o+l,l),e.arcTo(i+l,n,i,n,l),e.lineTo(r,n),e.arcTo(r-l,n,r-l,o+l,l),e.arcTo(r-l,o,r,o,l),e.closePath(),t)e.fillStyle=this.shadowColor,e.fill();else if(this.fillStyle){if(this.fillStyle.constructor===String)e.fillStyle=this.fillStyle;else if(u&&u.startPoint==o&&u.endPoint==n&&u.topColor==this.fillStyle.top&&u.bottomColor==this.fillStyle.bottom)e.fillStyle=u.gradient;else{var s=e.createLinearGradient(0,o,0,n);s.addColorStop(0,this.fillStyle.top),s.addColorStop(1,this.fillStyle.bottom),u={gradient:s,startPoint:o,endPoint:n,topColor:this.fillStyle.top,bottomColor:this.fillStyle.bottom},e.fillStyle=s}e.fill()}return!t&&this.strokeColor&&(e.lineWidth=this.strokeWidth,e.strokeStyle=this.strokeColor,e.stroke()),this.globalCompositeOperation&&(e.globalCompositeOperation="source-over"),this.hitTarget?c:void 0}}}).defaults({fillStyle:null,strokeColor:null,strokeWidth:1,layer:"default",orderInLayer:0,hitTarget:!1,shadowDistance:0,shadowColor:"rgba(0, 0, 0, .3)",globalCompositeOperation:null}).describe({fillStyle:{oneOf:[{type:"string"},{type:"object",properties:{top:{type:"string",bottom:{type:"string"}}},required:["top","bottom"]},{type:"object",properties:{left:{type:"string",right:{type:"string"}}},required:["left","right"]}]},strokeColor:{type:"string"},strokeWidth:{type:"number"},layer:{type:"string"},orderInLayer:{type:"integer"},shadowDistance:{type:"number"},shadowColor:{type:"string"},hitTarget:{type:"boolean"},globalCompositeOperation:{type:"string"}}),window.omelet.egg("omelet.ui.rectangle",function(t,e){this.fillStyle=t.fillStyle,this.strokeColor=t.strokeColor,this.strokeWidth=t.strokeWidth,this.cornerRadius=t.cornerRadius,this.hitTarget=t.hitTarget,this.shadowDistance=t.shadowDistance,this.shadowColor=t.shadowColor,this.globalCompositeOperation=t.globalCompositeOperation;var r,o,i,n,s,a,l,h=null,c=null;this.ready=function(e,r){r.screenSort=[e.layers[t.layer]||0,t.orderInLayer]},this.preDraw=function(t){h=t;var e=t.getRect();return r=e[0],o=e[1],i=e[2],n=e[3],s=r+i,a=o+n,c=[],c.push(t.transformPoint(r,o)),c.push(t.transformPoint(s,o)),c.push(t.transformPoint(s,a)),c.push(t.transformPoint(r,a)),c},this.draw=function(t){if(h){t||0==this.shadowDistance||this.draw(!0);var e=h.getContext();if(this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation),t&&e.translate(this.shadowDistance,this.shadowDistance),t)e.fillStyle=this.shadowColor,e.fillRect(r,o,i,n);else if(this.fillStyle){if(this.fillStyle.constructor===String)e.fillStyle=this.fillStyle;else if(l&&l.startPoint==o&&l.endPoint==a&&l.topColor==this.fillStyle.top&&l.bottomColor==this.fillStyle.bottom)e.fillStyle=l.gradient;else{var s=e.createLinearGradient(0,o,0,a);s.addColorStop(0,this.fillStyle.top),s.addColorStop(1,this.fillStyle.bottom),l={gradient:s,startPoint:o,endPoint:a,topColor:this.fillStyle.top,bottomColor:this.fillStyle.bottom},e.fillStyle=s}e.fillRect(r,o,i,n)}return!t&&this.strokeColor&&(e.lineWidth=this.strokeWidth,e.strokeStyle=this.strokeColor,e.strokeRect(r,o,i,n)),this.globalCompositeOperation&&(e.globalCompositeOperation="source-over"),this.hitTarget?c:void 0}}}).defaults({fillStyle:null,strokeColor:null,strokeWidth:1,layer:"default",orderInLayer:0,hitTarget:!1,shadowDistance:0,shadowColor:"rgba(0, 0, 0, .3)",globalCompositeOperation:null}).describe({fillStyle:{oneOf:[{type:"string"},{type:"object",properties:{top:{type:"string",bottom:{type:"string"}}},required:["top","bottom"]},{type:"object",properties:{left:{type:"string",right:{type:"string"}}},required:["left","right"]}]},strokeColor:{type:"string"},strokeWidth:{type:"number"},layer:{type:"string"},orderInLayer:{type:"integer"},shadowDistance:{type:"number"},shadowColor:{type:"string"},hitTarget:{type:"boolean"},globalCompositeOperation:{type:"string"}}),window.omelet.egg("omelet.ui.roundedRectangle",function(t,e){this.fillStyle=t.fillStyle,this.strokeColor=t.strokeColor,this.strokeWidth=t.strokeWidth,this.cornerRadius=t.cornerRadius,this.hitTarget=t.hitTarget,this.shadowDistance=t.shadowDistance,this.shadowColor=t.shadowColor,this.globalCompositeOperation=t.globalCompositeOperation;var r,o,i,n,s,a,l,h=null,c=null;this.ready=function(e,r){r.screenSort=[e.layers[t.layer]||0,t.orderInLayer]},this.preDraw=function(t){h=t;var e=t.getRect();return r=e[0],o=e[1],s=e[2],a=e[3],i=r+s,n=o+a,c=[t.transformPoint(r,o),t.transformPoint(i,o),t.transformPoint(i,n),t.transformPoint(r,n)]},this.draw=function(t){if(h){t||0==this.shadowDistance||this.draw(!0);var e=this.cornerRadius;e>.5*s&&(e=.5*s),e>.5*a&&(e=.5*a);var u=h.getContext();if(this.globalCompositeOperation&&(u.globalCompositeOperation=this.globalCompositeOperation),t&&u.translate(this.shadowDistance,this.shadowDistance),u.beginPath(),u.moveTo(r+e,o),u.lineTo(i-e,o),u.arcTo(i,o,i,o+e,e),u.lineTo(i,n-e),u.arcTo(i,n,i-e,n,e),u.lineTo(r+e,n),u.arcTo(r,n,r,n-e,e),u.lineTo(r,o+e),u.arcTo(r,o,r+e,o,e),u.closePath(),t)u.fillStyle=this.shadowColor,u.fill();else if(this.fillStyle){if(this.fillStyle.constructor===String)u.fillStyle=this.fillStyle;else if(l&&l.startPoint==o&&l.endPoint==n&&l.topColor==this.fillStyle.top&&l.bottomColor==this.fillStyle.bottom)u.fillStyle=l.gradient;else{var p=u.createLinearGradient(0,o,0,n);p.addColorStop(0,this.fillStyle.top),p.addColorStop(1,this.fillStyle.bottom),l={gradient:p,startPoint:o,endPoint:n,topColor:this.fillStyle.top,bottomColor:this.fillStyle.bottom},u.fillStyle=p}u.fill()}return!t&&this.strokeColor&&(u.lineWidth=this.strokeWidth,u.strokeStyle=this.strokeColor,u.stroke()),this.globalCompositeOperation&&(u.globalCompositeOperation="source-over"),this.hitTarget?c:void 0}}}).defaults({fillStyle:null,strokeColor:null,strokeWidth:1,cornerRadius:10,layer:"default",orderInLayer:0,hitTarget:!1,shadowDistance:0,shadowColor:"rgba(0, 0, 0, .3)",globalCompositeOperation:null}).describe({fillStyle:{oneOf:[{type:"string"},{type:"object",properties:{top:{type:"string",bottom:{type:"string"}}},required:["top","bottom"]},{type:"object",properties:{left:{type:"string",right:{type:"string"}}},required:["left","right"]}]},strokeColor:{type:"string"},strokeWidth:{type:"number"},cornerRadius:{type:"number"},layer:{type:"string"},orderInLayer:{type:"integer"},shadowDistance:{type:"number"},shadowColor:{type:"string"},hitTarget:{type:"boolean"},globalCompositeOperation:{type:"string"}}),window.omelet.egg("omelet.ui.spriteRenderer",function(t,e){this.spriteName=t.spriteName,this.maintainAspect=t.maintainAspect,this.alignment=t.alignment,this.hitTarget=t.hitTarget,this.globalCompositeOperation=t.globalCompositeOperation;var r,o,i,n,s,a,l;this.ready=function(r,o){o.screenSort=[r.layers[t.layer]||0,t.orderInLayer],l=e.spriteSheet},this.preDraw=function(t){s=t;var e=t.getRect();if(a=[],!l||!l.loaded)return a;var h=l.sprites[this.spriteName];if(!h)return a;if(r=e[0],o=e[1],i=e[2],n=e[3],this.maintainAspect&&h.height>0){var c=h.width/h.height,u=h.height,p=h.width;switch(p>i&&(p=i,u=i/c),u>n&&(u=n,p=u*c),this.alignment){case"top-left":break;case"top":r+=(i-p)/2;break;case"top-right":r+=i-p;break;case"left":o+=(n-u)/2;break;case"center":r+=(i-p)/2,o+=(n-u)/2;break;case"right":r+=i-p,o+=(n-u)/2;break;case"bottom-left":o+=n-u;break;case"bottom":r+=(i-p)/2,o+=n-u;case"bottom-right":r+=i-p,o+=n-u}i=p,n=u}var f=r+i,d=o+n;return a=[t.transformPoint(r,o),t.transformPoint(f,o),t.transformPoint(f,d),t.transformPoint(r,d)]},this.draw=function(){var t=s.getContext();this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation);var e=l.sprites[this.spriteName];return t.drawImage(l.image,e.x,e.y,e.width,e.height,r,o,i,n),this.hitTarget?a:void(this.globalCompositeOperation&&(t.globalCompositeOperation="source-over"))}}).defaults({spriteName:"Default",maintainAspect:!1,alignment:"center",hitTarget:!1,layer:"default",orderInLayer:0,globalCompositeOperation:null}).references({spriteSheet:"omelet.sprites.spriteSheet"}).describe({spriteName:{type:"string"},maintainAspect:{type:"boolean"},alignment:{"enum":["top-left","top","top-right","left","center","right","bottom-left","bottom","bottom-right"]},layer:{type:"string"},orderInLayer:{type:"integer"},hitTarget:{type:"boolean"},globalCompositeOperation:{type:"string"}}),function(){var t=document.createElement("canvas"),e=t.getContext("2d");window.omelet.egg("omelet.ui.textRenderer",function(r,o){this.text=r.text,this.color=r.color,this.font=r.font,this.lineHeight=r.lineHeight,this.align=r.align,this.verticalAlign=r.verticalAlign,this.wrapText=r.wrapText,this.globalCompositeOperation=r.globalCompositeOperation;var i=null,n=0,s=0,a=0,l=0,h=new Image,c=null;this.ready=function(t,e){e.screenSort=[t.layers[r.layer]||0,r.orderInLayer]},this.preDraw=function(t){i=t;var e=t.getRect();if(n=e[0],s=e[1],a=e[2],l=e[3],!(0>=a||0>=l||""==this.text)){var r=n+a,o=s+l;return[t.transformPoint(n,s),t.transformPoint(r,s),t.transformPoint(r,o),t.transformPoint(n,o)]}},this.draw=function(){c&&c.width==a&&c.height==l&&c.text==this.text&&c.color==this.color&&c.font==this.font&&c.lineHeight==this.lineHeight&&c.align==this.align&&c.verticalAlign==this.verticalAlign&&c.wrapText==this.wrapText||(c={width:a,height:l,text:this.text,color:this.color,font:this.font,lineHeight:this.lineHeight,align:this.align,verticalAlign:this.verticalAlign,wrapText:this.wrapText},u(c));var t=i.getContext();this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation),t.drawImage(h,n,s),this.globalCompositeOperation&&(t.globalCompositeOperation="source-over")};var u=function(r,o){t.width=r.width,t.height=r.height,e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,a,l),o?e.scale(o,o):o=1;var i=r.width/o,n=r.height/o;e.font=r.font,e.textBaseline="middle",e.textAlign=r.align,e.fillStyle=r.color;var s=[];if(r.wrapText){for(var c=r.text||"",p=c.split(" "),f="",d=0;d<p.length;){var g=0===d?p[0]:f+" "+p[d],m=e.measureText(g);m.width>i?(""!=f&&s.push(f),f=p[d]):f=g,d+=1}s.push(f)}else s.push(r.text||"");var y=s.length*r.lineHeight;if(y>n&&0!=n){var v=.5*o,b=n/y;return b>.5&&(v=b*o),void u(r,v)}var w="left"==r.align?0:"right"==r.align?i:i/2,C="top"==r.verticalAlign?r.lineHeight/2:"bottom"==r.verticalAlign?n-y+r.lineHeight/2:(n-y+r.lineHeight)/2;s.forEach(function(t){e.fillText(t,w,C,i),C+=r.lineHeight}),h.width=r.width,h.height=r.height,h.src=t.toDataURL()}}).defaults({text:"New Text",color:"black",font:"30px sans-serif",lineHeight:35,align:"center",verticalAlign:"center",layer:"default",orderInLayer:0,wrapText:!0,globalCompositeOperation:null}).describe({text:{type:"string"},color:{type:"string"},font:{type:"string"},lineHeight:{type:"number"},align:{"enum":["left","center","right"]},verticalAlign:{"enum":["top","center","bottom"]},wrapText:{type:"boolean"},layer:{type:"string"},orderInLayer:{type:"integer"},globalCompositeOperation:{type:"string"}})}(),window.omelet.egg("omelet.rectTransform",function(t,e){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom,this.offsetLeft=t.offsetLeft,this.offsetTop=t.offsetTop,this.offsetRight=t.offsetRight,this.offsetBottom=t.offsetBottom,this.minWidthPixels=t.minWidthPixels,this.minHeightPixels=t.minHeightPixels,this.maxWidthPercent=t.maxWidthPercent,this.maxHeightPercent=t.maxHeightPercent,this.transform=function(t){var e=t.getRect(),r=e[2],o=e[3],i=this.left*r+this.offsetLeft,n=this.top*o+this.offsetTop,s=this.right*r-this.offsetRight-i,a=this.bottom*o-this.offsetBottom-n;if(s<this.minWidthPixels&&(i-=(this.minWidthPixels-s)/2,s=this.minWidthPixels),a<this.minHeightPixels&&(n-=(this.minHeightPixels-a)/2,a=this.minHeightPixels),0!=r&&s/r>this.maxWidthPercent){var l=this.maxWidthPercent*r;i+=(s-l)/2,s=l}if(0!=o&&a/o>this.maxHeightPercent){var h=this.maxHeightPercent*o;n+=(a-h)/2,a=h}e=[e[0]+i,e[1]+n,s,a],this.actualWidth=s,this.actualHeight=a,t.setRect(e)}}).defaults({left:0,top:0,right:1,bottom:1,offsetLeft:0,offsetTop:0,offsetRight:0,offsetBottom:0,minWidthPixels:0,minHeightPixels:0,maxWidthPercent:2,maxHeightPercent:2}).describe({left:{type:"number"},top:{type:"number"},right:{type:"number"},bottom:{type:"number"},offsetLeft:{type:"number"},offsetTop:{type:"number"},offsetRight:{type:"number"},offsetBottom:{type:"number"},minWidthPixels:{type:"number"},minHeightPixels:{type:"number"},maxWidthPercent:{type:"number"},maxHeightPercent:{type:"number"}}),window.omelet.egg("omelet.transform",function(t,e){this.x=t.x,this.y=t.y,this.xScale=t.xScale,this.yScale=t.yScale,this.angle=t.angle;var r=null;this.transform=function(t){return t.translate(this.x,this.y),t.scale(this.xScale,this.yScale),t.rotate(this.angle),r=t.getSnapshot()},this.getPosition=function(){return r?r.transformPoint(0,0):[0,0]},this.setPosition=function(t,e){var o=r?r.inverseTransformInParentSpace(t,e):[t,e];this.x=o[0],this.y=o[1]}}).defaults({x:0,y:0,angle:0,xScale:1,yScale:1}).describe({x:{type:"number"},y:{type:"number"},angle:{type:"number"},xScale:{type:"number"},yScale:{type:"number"}});
//# sourceMappingURL=omelet.min.js.map