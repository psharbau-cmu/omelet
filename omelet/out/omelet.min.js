!function(){var t={};window.omelet={salt:function(n,e){if(e){var r=e(t);n&&r&&(window.omelet[n]=r)}}}}(),function(){var t=function(t,n){var e=null,r=null,o=null;this.create=function(i,a,u){if(u){if(i=i||{},a=a||{},o&&o.forEach(function(n){return u[n]?void 0:void console.log("Entity missing required component: "+t+" needs "+n)}),e)for(var s in e){if(!a.hasOwnProperty(s))return void console.log("Entity missing needed reference: "+t+" references an entity for "+s+" needing a "+e[s]);if(!a[s][e[s]])return void console.log("Referenced entity missing needed component: "+t+" references an entity for "+s+" that needs a "+e[s])}if(r)for(var s in r)i.hasOwnProperty(s)||(i[s]=r[s]);return new n(i,a)}},this.references=function(t){return e=e||t,this},this.requires=function(t){return o=o||t,this},this.defaults=function(t){return r=r||t,this}};window.omelet.salt("egg",function(n){var e={};return n.eggs=e,function(n,r){if(n&&r){var o=new t(n,r);return e[n]=o,o}}})}(),function(){var t=function(t){var n=[];n.push(t[3]),n.push(-1*t[1]),n.push(-1*t[2]),n.push(t[0]),n.push(t[2]*t[5]-t[4]*t[3]),n.push(t[4]*t[2]-t[0]*t[5]);for(var e=t[0]*n[0]+t[2]*n[1],r=0;6>r;r+=1)n[r]/=e;return n},n=function(t,n,e){var r=e[0]*t+e[2]*n+e[4],o=e[1]*t+e[3]*n+e[5];return[r,o]},e=function(n,e,r){var o=t(r),i=o[0]*n+o[2]*e+o[4],a=o[1]*n+o[3]*e+o[5];return[i,a]},r=function(t,n,e,r){this.currentMatrix=t.slice(),this.context2d=n,this.parent=e?e.slice():null,this.rect=r};r.prototype.getContext=function(){return this.context2d.setTransform.apply(this.context2d,this.currentMatrix),this.context2d},r.prototype.getIdentityContext=function(){return this.context2d.setTransform(1,0,0,1,0,0),this.context2d},r.prototype.transformPoint=function(t,e){return n(t,e,this.currentMatrix)},r.prototype.inverseTransformPoint=function(t,n){return e(t,n,this.currentMatrix)},r.prototype.inverseTransformInParentSpace=function(t,n){return this.parent?e(t,n,this.parent):[t,n]},r.prototype.getRect=function(){return this.rect||[0,0,0,0]},window.omelet.salt(null,function(t){t.wrapContext=function(t){var o={matrix:[1,0,0,1,0,0],last:null,rect:null},i=function(t){var n=o.matrix.slice();o.matrix[0]=n[0]*t[0]+n[2]*t[1],o.matrix[1]=n[1]*t[0]+n[3]*t[1],o.matrix[2]=n[0]*t[2]+n[2]*t[3],o.matrix[3]=n[1]*t[2]+n[3]*t[3],o.matrix[4]=n[0]*t[4]+n[2]*t[5]+n[4],o.matrix[5]=n[1]*t[4]+n[3]*t[5]+n[5]};return{save:function(){var t=o.matrix.slice(),n=o.rect?o.rect.slice():null;o={matrix:t,last:o,rect:n}},restore:function(){o.last&&(o=o.last)},scale:function(t,n){i([t,0,0,n,0,0])},rotate:function(t){var n=Math.cos(t),e=Math.sin(t);i([n,e,-1*e,n,0,0])},translate:function(t,n){i([1,0,0,1,t,n])},shear:function(t,n){i([1,n,t,1,0,0])},transform:function(t,n,e,r,o,a){i([t,n,e,r,o,a])},setTransform:function(t,n,e,r,i,a){o.matrix=[t,n,e,r,i,a]},reset:function(){o={matrix:[1,0,0,1,0,0],last:null}},transformPoint:function(t,e){return n(t,e,o.matrix)},inverseTransformPoint:function(t,n){return e(t,n,o.matrix)},getSnapshot:function(){return new r(o.matrix,t,o.last?o.last.matrix:null,o.rect)},setRect:function(t){o.rect=t},getRect:function(t){return o.rect||[0,0,0,0]}}}})}(),function(){window.omelet.salt(null,function(n){n.testIntersection=function(n,e){return t(n,e)&&t(e,n)}});var t=function(t,n){var e,r,o,i,a,u,s=t.length,c=n.length;for(e=0;s>e;e+=1){var f=t[(e+1)%s],l=t[e],m=-1*(f[1]-l[1]),h=f[0]-l[0];for(o=Number.MAX_VALUE,i=Number.MIN_VALUE,r=0;s>r;r+=1){var d=m*t[r][0]+h*t[r][1];o>d&&(o=d),d>i&&(i=d)}for(a=Number.MAX_VALUE,u=Number.MIN_VALUE,r=0;c>r;r+=1){var d=m*n[r][0]+h*n[r][1];a>d&&(a=d),d>u&&(u=d)}if(o>u||a>i)return!1}return!0}}(),function(){window.omelet.salt(null,function(t){t.testPointInPolygon=function(t,n,e){for(var r=0;r<e.length;r+=1){var o=e[(r+1)%e.length],i=e[r],a=o[0]-i[0],u=o[1]-i[1],s=t-i[0],c=n-i[1],f=a*s+u*c;if(0>f)return!1}return!0}})}(),function(){var t=function(t){var e=[];return t.forEach(function(t){t&&t.constructor===String&&e.push(n(t))}),e},n=function(t){};window.omelet.salt(null,function(e){e.realize=function(e){if(e){if(e.constructor===Array)return t(e);if(e.constructor===String)return n(e);console.log("Error realizing data.  Objects are not supported with prototypes of: "+e.constructor)}else console.log("Error realizing data.  Falsy input cannot be realized.")}})}(),function(){window.omelet.salt("makeGame",function(t){return function(n,e){if(n&&e){var r=n.getContext("2d"),o=r.width,i=r.height,a=[],u=t.wrapContext(r),s=t.createOnScreenTree(),c=[-10,-10],f=!1,l=!1,m=null,h=!1,d=0;n.addEventListener("mousedown",function(t){f=!0}),n.addEventListener("mouseup",function(t){f=!1}),n.addEventListener("mousemove",function(t){var e=n.getBoundingClientRect();c=[t.clientX-e.left,t.clientY-e.top]}),t.realizeScene(e),e.Context=r;var v=function(n){if(u.save(),n.transform)var e=n.transform(u);if(n.preDraw){var r=n.preDraw(e||u.getSnapshot());t.testIntersection(a,r)?n.onScreenNode||s.insert(n):n.onScreenNode&&n.onScreenNode.remove()}n.children&&n.children.forEach(v),u.restore()},p=function(n){for(e.MousePosition=c,e.MouseDown=f;n.length>0;){var r=n.pop(),o=c[0],i=c[1];if(t.testPointInPolygon(o,i,r.box))return m!=r.entity&&(m&&m.mouseExit&&m.mouseExit(),m=r.entity,m.mouseEnter&&m.mouseEnter()),void(l!=f&&(f&&m.mouseDown?m.mouseDown():!f&&m.mouseUp&&m.mouseUp(),l=f))}m&&m.mouseExit&&m.mouseExit(),m=null,l=f},g=function(){o=n.width,i=n.height,a=[[0,0],[o,0],[o,i],[0,i]];var t=(new Date).getTime(),c=(t-(d||t))/1e3;c>1&&(c=.016),d=t,e.update(c),u.setRect([0,0,o,i]),u.save(),u.translate(o/2,i/2);var f=e.Camera;u.translate(-1*f.x,-1*f.y),0!=f.angle&&u.rotate(-1*f.angle),u.scale(f.zoom,f.zoom),e.Hierarchy.forEach(v),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,o,i);var l=s.draw();l&&l.length>0&&p(l),u.restore(),h&&window.requestAnimationFrame(g)};return{start:function(){h||(h=!0,window.requestAnimationFrame(g))},stop:function(){h=!1}}}}})}(),omelet.egg("omelet.transform",function(t,n){this.x=t.x,this.y=t.y,this.angle=t.angle,this.update=function(t){}}).defaults({x:0,y:0,angle:0});