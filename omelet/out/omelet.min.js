!function(){var t={};window.omelet={salt:function(n,e){if(e){var r=e(t);n&&r&&(window.omelet[n]=r)}}}}(),function(){var t=function(t,n){var e=null,r=null,o=null;this.create=function(i,a,s){if(s){if(i=i||{},a=a||{},o&&o.forEach(function(n){return s[n]?void 0:void console.log("Entity missing required component: "+t+" needs "+n)}),e)for(var c in e){if(!a.hasOwnProperty(c)||!a[c])return void console.log("Entity missing needed reference: "+t+" references an entity for "+c+" needing a "+e[c]);if(!a[c][e[c]])return void console.log("Referenced entity missing needed component: "+t+" references an entity for "+c+" that needs a "+e[c])}if(r)for(var c in r)i.hasOwnProperty(c)||(i[c]=r[c]);return new n(i,a)}},this.references=function(t){return e=e||t,this},this.requires=function(t){return o=o||t,this},this.defaults=function(t){return r=r||t,this}};window.omelet.salt("egg",function(n){var e={};return n.eggs=e,function(n,r){if(n&&r){var o=new t(n,r);return e[n]=o,o}}})}(),function(){var t=function(t){var n=[];n.push(t[3]),n.push(-1*t[1]),n.push(-1*t[2]),n.push(t[0]),n.push(t[2]*t[5]-t[4]*t[3]),n.push(t[4]*t[2]-t[0]*t[5]);for(var e=t[0]*n[0]+t[2]*n[1],r=0;6>r;r+=1)n[r]/=e;return n},n=function(t,n,e){var r=e[0]*t+e[2]*n+e[4],o=e[1]*t+e[3]*n+e[5];return[r,o]},e=function(n,e,r){var o=t(r),i=o[0]*n+o[2]*e+o[4],a=o[1]*n+o[3]*e+o[5];return[i,a]},r=function(t,n,e,r){this.currentMatrix=t.slice(),this.context2d=n,this.parent=e?e.slice():null,this.rect=r};r.prototype.getContext=function(){return this.context2d.setTransform.apply(this.context2d,this.currentMatrix),this.context2d},r.prototype.getIdentityContext=function(){return this.context2d.setTransform(1,0,0,1,0,0),this.context2d},r.prototype.transformPoint=function(t,e){return n(t,e,this.currentMatrix)},r.prototype.inverseTransformPoint=function(t,n){return e(t,n,this.currentMatrix)},r.prototype.inverseTransformInParentSpace=function(t,n){return this.parent?e(t,n,this.parent):[t,n]},r.prototype.getRect=function(){return this.rect||[0,0,0,0]},window.omelet.salt(null,function(t){t.wrapContext=function(t){if(!t||t.constructor!==CanvasRenderingContext2D)return void console.log("Error wrapping context.  Passed context must be of type CanvasRenderingContext2D");var o={matrix:[1,0,0,1,0,0],last:null,rect:null},i=function(t){var n=o.matrix.slice();o.matrix[0]=n[0]*t[0]+n[2]*t[1],o.matrix[1]=n[1]*t[0]+n[3]*t[1],o.matrix[2]=n[0]*t[2]+n[2]*t[3],o.matrix[3]=n[1]*t[2]+n[3]*t[3],o.matrix[4]=n[0]*t[4]+n[2]*t[5]+n[4],o.matrix[5]=n[1]*t[4]+n[3]*t[5]+n[5]};return{save:function(){var t=o.matrix.slice(),n=o.rect?o.rect.slice():null;o={matrix:t,last:o,rect:n}},restore:function(){o.last&&(o=o.last)},scale:function(t,n){i([t,0,0,n,0,0])},rotate:function(t){var n=Math.cos(t),e=Math.sin(t);i([n,e,-1*e,n,0,0])},translate:function(t,n){i([1,0,0,1,t,n])},shear:function(t,n){i([1,n,t,1,0,0])},transform:function(t,n,e,r,o,a){i([t,n,e,r,o,a])},setTransform:function(t,n,e,r,i,a){o.matrix=[t,n,e,r,i,a]},reset:function(){o={matrix:[1,0,0,1,0,0],last:null}},transformPoint:function(t,e){return n(t,e,o.matrix)},inverseTransformPoint:function(t,n){return e(t,n,o.matrix)},getSnapshot:function(){return new r(o.matrix,t,o.last?o.last.matrix:null,o.rect)},setRect:function(t){o.rect=t},getRect:function(t){return o.rect||[0,0,0,0]}}}})}(),function(){window.omelet.salt(null,function(n){n.testIntersection=function(n,e){return t(n,e)&&t(e,n)}});var t=function(t,n){var e,r,o,i,a,s,c=t.length,u=n.length;for(e=0;c>e;e+=1){var l=t[(e+1)%c],f=t[e],h=-1*(l[1]-f[1]),m=l[0]-f[0];for(o=Number.MAX_VALUE,i=Number.MIN_VALUE,r=0;c>r;r+=1){var d=h*t[r][0]+m*t[r][1];o>d&&(o=d),d>i&&(i=d)}for(a=Number.MAX_VALUE,s=Number.MIN_VALUE,r=0;u>r;r+=1){var d=h*n[r][0]+m*n[r][1];a>d&&(a=d),d>s&&(s=d)}if(o>s||a>i)return!1}return!0}}(),function(){window.omelet.salt(null,function(t){t.testPointInPolygon=function(t,n,e){for(var r=0;r<e.length;r+=1){var o=e[(r+1)%e.length],i=e[r],a=o[0]-i[0],s=o[1]-i[1],c=t-i[0],u=n-i[1],l=a*c+s*u;if(0>l)return!1}return!0}})}(),function(){var t=function(t,n){var r=[],o={};return t.forEach(function(t){if(t){var n=new e;n.matchData(t,o)&&r.push(n)}}),r.forEach(function(t){t.realize(o,n)}),r},n={components:!0,onScreenNode:!0,screenSort:!0,hasChildren:!0,children:!1,key:!1,name:!1,update:!0,preDraw:!0,draw:!0,transform:!0,mouseEnter:!0,mouseExit:!0,mouseUp:!0,mouseDown:!0,mouseClick:!0},e=function(){this.components=[],this.onScreenNode=null,this.screenSort=[],this.hasChildren=!1,this.children=[],this.key="",this.name=""};e.prototype.matchData=function(t,r){if(!t||!r||t.constructor!==Object||r.constructor!==Object)return console.log("Error matching data.  Data obj or key map is falsy or not an Object."),!1;t.name&&(t.name.constructor===String?this.name=t.name:console.log("Error matching data.  Non-string name ignored.")),t.key&&(t.key.constructor===String?(this.key=t.key,r[t.key]=this):console.log("Error matching data.  Non-string key ignored.")),t.children&&(t.children.constructor===Array?t.children.forEach(function(t){var n=new e;n.matchData(t,r)&&(this.hasChildren=!0,this.children.push(n))}):console.log("Error matching data.  Non-array children ignored."));for(var o in t){if(n[o])return console.log("Error matching data. Data contains a runtime only property: "+o),!1;n.hasOwnProperty(o)||(this[o]?console.log("Error matching data.  Duplicate component type on entity not allowed: "+o):(this.components.push(o),this[o]=t[o]))}return!0},e.prototype.realize=function(t,n){if(!t||!n||t.constructor!==Object||n.constructor!==Object)return void console.log("Error realizing entity.  Key map or egg carton is falsy or not an Object.");var e=null,r=null,o=null,i=[],a=[],s=[],c=[],u=[],l=[];this.components.forEach(function(f){if(!n[f])return void console.log("Error realizing component.  No egg registered for type: "+f);var h=this[f],m=null!=h?h.data:null,d=null!=h?h.refs:null;if(null!=d&&d.constructor===Object)for(var g in d)d[g]&&d[g].constructor===String&&(t[d[g]]?d[g]=t[d[g]]:console.log("Error realizing component.  An entity with name: "+this.name+" references an entity for: "+g+" with missing key: "+d[g]));var p=n[f].create(m,d,this);this[f]=p,p.transform&&p.transform.constructor===Function&&(e?console.log("Error realizing component.  Entity contains two eggs with transform functions.  Only one allowed.  Name: "+this.name+"  Key: "+this.key):e=p),p.preDraw&&p.preDraw.constructor===Function&&(r?console.log("Error realizing component.  Entity contains two eggs with preDraw functions.  Only one allowed.  Name: "+this.name+"  Key: "+this.key):r=p),p.draw&&p.draw.constructor===Function&&(o?console.log("Error realizing component.  Entity contains two eggs with draw functions.  Only one allowed.  Name: "+this.name+"  Key: "+this.key):o=p),p.update&&p.update.constructor===Function&&i.push(p),p.mouseEnter&&p.mouseEnter.constructor===Function&&a.push(p),p.mouseExit&&p.mouseExit.constructor===Function&&s.push(p),p.mouseUp&&p.mouseUp.constructor===Function&&u.push(p),p.mouseDown&&p.mouseDown.constructor===Function&&c.push(p),p.mouseClick&&p.mouseClick.constructor===Function&&l.push(p)}),e&&(this.transform=function(t){return e.transform(t)}),r&&(this.preDraw=function(t){return r.preDraw(t)}),o&&(this.draw=function(){return o.draw()}),i.length>0&&(this.update=function(t){i.forEach(function(n){n.update(t)})}),a.length>0&&(this.mouseEnter=function(){a.forEach(function(t){t.mouseEnter()})}),s.length>0&&(this.mouseExit=function(){s.forEach(function(t){t.mouseExit()})}),u.length>0&&(this.mouseUp=function(){u.forEach(function(t){t.mouseUp()})}),c.length>0&&(this.mouseDown=function(){c.forEach(function(t){t.mouseDown()})}),l.length>0&&(this.mouseClick=function(){l.forEach(function(t){t.mouseClick()})}),this.hasChildren&&this.children.forEach(function(e){e.realize(t,n)})},window.omelet.salt(null,function(n){n.realize=function(e){if(e)if(e.constructor===String)try{var r=JSON.parse(e);if(r.constructor===Array)return t(e,n.eggs);console.log("Error realizing data, input must be JSON representation of array.")}catch(o){console.log("Error realizing data.  JSON parse failed: "+o)}else console.log("Error realizing data.  Data Objects are not supported with prototypes of: "+e.constructor);else console.log("Error realizing data.  Falsy input cannot be realized.")}})}(),function(){window.omelet.salt("createEmptyScene",function(t){return function(){}})}(),function(){window.omelet.salt("makeGame",function(t){return function(n,e){if(n&&e){var r=n.getContext("2d"),o=r.width,i=r.height,a=[],s=t.wrapContext(r),c=t.createOnScreenTree(),u=[-10,-10],l=!1,f=!1,h=null,m=!1,d=0;n.addEventListener("mousedown",function(t){l=!0}),n.addEventListener("mouseup",function(t){l=!1}),n.addEventListener("mousemove",function(t){var e=n.getBoundingClientRect();u=[t.clientX-e.left,t.clientY-e.top]}),t.realizeScene(e),e.Context=r;var g=function(n){if(s.save(),n.transform)var e=n.transform(s);if(n.preDraw){var r=n.preDraw(e||s.getSnapshot());t.testIntersection(a,r)?n.onScreenNode||c.insert(n):n.onScreenNode&&n.onScreenNode.remove()}n.children&&n.children.forEach(g),s.restore()},p=function(n){for(e.MousePosition=u,e.MouseDown=l;n.length>0;){var r=n.pop(),o=u[0],i=u[1];if(t.testPointInPolygon(o,i,r.box))return h!=r.entity&&(h&&h.mouseExit&&h.mouseExit(),h=r.entity,h.mouseEnter&&h.mouseEnter()),void(f!=l&&(l&&h.mouseDown?h.mouseDown():!l&&h.mouseUp&&h.mouseUp(),f=l))}h&&h.mouseExit&&h.mouseExit(),h=null,f=l},w=function(){o=n.width,i=n.height,a=[[0,0],[o,0],[o,i],[0,i]];var t=(new Date).getTime(),u=(t-(d||t))/1e3;u>1&&(u=.016),d=t,e.update(u),s.setRect([0,0,o,i]),s.save(),s.translate(o/2,i/2);var l=e.Camera;s.translate(-1*l.x,-1*l.y),0!=l.angle&&s.rotate(-1*l.angle),s.scale(l.zoom,l.zoom),e.Hierarchy.forEach(g),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,o,i);var f=c.draw();f&&f.length>0&&p(f),s.restore(),m&&window.requestAnimationFrame(w)};return{start:function(){m||(m=!0,window.requestAnimationFrame(w))},stop:function(){m=!1}}}}})}(),omelet.egg("omelet.transform",function(t,n){this.x=t.x,this.y=t.y,this.angle=t.angle,this.update=function(t){}}).defaults({x:0,y:0,angle:0});